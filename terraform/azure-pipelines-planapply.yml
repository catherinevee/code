variables:
  storageAccountName: "tfstatesa"
  containerName: "tfstate-container"
  terraform_version: 1.11.3
  resourceGroup: "polandcentralrg-1"
  backendServiceArm: "catherinevee_manid"
  backendAzureRmResourceGroupName: $(resourceGroup)
  backendAzureRmStorageAccountName: $(storageAccountName)
  backendAzureRmContainerName: $(containerName)
  backendAzureRmKey: "terraform.tfstate"
 

trigger:
- main
name: $(BuildDefinitionName)_$(date:yyyyMMdd)$(rev:.r) 
pr: none


stages :  
  - stage: terraform_plan_apply
    jobs:
      - job: terraform_apply
        steps:
        - task: JasonBJohnson.azure-pipelines-tasks-terraform.azure-pipelines-tasks-terraform-installer.TerraformInstaller@0
          inputs:
            terraformVersion: '$(terraform_version)'
        - task: AzureCLI@2
          inputs:
            azureSubscription: 'catherinevee_manid'
            scriptType: 'bash'
            scriptLocation: 'inlineScript'
            inlineScript: |
              # Set Azure Subscription
              az account set -s thomasthorntoncloud
              
              # Create resource group
              az group create -l uksouth -n thomasthorntoncloud
              
              # Create storage account
              az storage account create -n thomasthorntontfstate -g thomasthorntoncloud -l uksouth --sku Standard_LRS --kind StorageV2
              
              # Create blob container
              az storage container create --account-name thomasthorntontfstate --name exampletfstate 