variables:
  storageAccountName: "tfstatesa"
  containerName: "tfstate-container"
  terraform_version: 1.11.3
  resourceGroup: "polandcentralrg-1"
  backendServiceArm: "catherinevee_manid"
  backendAzureRmResourceGroupName: $(resourceGroup)
  backendAzureRmStorageAccountName: $(storageAccountName)
  backendAzureRmContainerName: $(containerName)
  backendAzureRmKey: "terraform.tfstate"
 

trigger:
- main
name: $(BuildDefinitionName)_$(date:yyyyMMdd)$(rev:.r) 
pr: none


stages :  
  - stage: terraform_plan_apply
    jobs:
      - job: terraform_apply@0
        steps:
        - task: JasonBJohnson.azure-pipelines-tasks-terraform.azure-pipelines-tasks-terraform-installer.TerraformInstaller@0
          inputs:
            terraformVersion: '$(terraform_version)'
        - task: TerraformCLI@2
          inputs:
            command: 'init'
            backendType: 'azurerm'
            backendServiceArm: 'catherinevee_manid'
            backendAzureRmTenantId: $(AZURE_TENANT_ID)
            backendAzureRmSubscriptionId: $(AZURE_SUBSCRIPTION_ID)
            allowTelemetryCollection: true